<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Top 10 Job Failures</title>
</head>
<style>

text {
  font: 10px sans-serif;
}

rect.background {
  fill: white;
}

.axis {
  shape-rendering: crispEdges;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
}

.hidden text {
			display: none;
		}

  .tooltipsvg {
            position: absolute;
            width: 100px;
            height: auto;
            padding: 10px;
            background-color: white;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            pointer-events: none;
			left: 80%;
			-moz-transform: translate(-80%, 0);
			-webkit-transform: translate(-80%, 0);
			transform: translate(-80%, 0);
		}
  .tooltipsvg.hidden {
			display: none;
		}
  .tooltipsvg p {
             margin: 0;
             font-family: sans-serif;
             font-size: 12px;
             line-height: 20px;
		}

</style>
<body>
<div><p><h3>Top 10 Job Failures</h3></p></div>
<br>
<div id="navPathtop10job"></div>
<br>
<div id="top10job"></div>
<div></div>
<br />
<div id="contenttabletop10job"></div>
<br />
<div></div>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.9/d3.min.js" charset="utf-8">
		// src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.9/d3.min.js"   src="d3/d3.v3.js"
		// <script src="./d3.v3.min.js"> </ script>
		</script>
<script>


function drawtop10job(svgIn, jsonDataIn) { 

//String.prototype.hashCode = 
function hashCode(str) {
  var hash = 0, i, chr, len;
  if (str.length === 0) return hash;
  for (i = 0, len = str.length; i < len; i++) {
    chr   = str.charCodeAt(i);
    hash  = ((hash << 5) - hash) + chr;
    hash |= 0; // Convert to 32bit integer
  }
  return Math.abs(hash);
} //;

function getColor(idx) {
		var id = isNaN(idx) ? hashCode(idx) : idx ;
                var palette = [
                   "#0a72ff", "#1eff06", "#ff1902", "#ffe304", "#0d8c39", 
				   "#0f83aa", "#ba5f59", "#c602fe", "#f2affd", "#11fee3", 
				   "#8e7808", "#b7ff78", "#fe8f06", "#7b8f70", "#f00755", 
				   "#b14ece", "#feb87c", "#8fe7fd", "#8f6f92", "#0eff9f", 
				   "#74a2fd", "#08b401", "#ffbac4", "#fd75aa", "#c3cd7a", 
				   "#fe6e4c", "#77a009", "#aeff04", "#05aba2", "#a8feb7", 
				   "#fe32e8", "#bfc0ea", "#eab739", "#b56520", 
				   '#2ec7c9', 
				   '#b6a2de', '#5ab1ef', '#ffb980', '#d87a80', '#8d98b3', 
				   '#e5cf0d', '#97b552', '#95706d', '#dc69aa', '#07a2a4', 
				   '#9a7fd1', '#588dd5', '#f5994e', '#c05050', '#59678c', 
				   '#c9ab00', '#7eb00a', '#6f5553', '#c14089'
                ]
                return palette[id % palette.length];
            } 

var margin = {top: 30, right: 120, bottom: 0, left: 120},
    width = 800 - margin.left - margin.right, //960
    height = 400 - margin.top - margin.bottom;

var x = d3.scale.linear()
    .range([0, width]);

var barHeight = 20;

var color = d3.scale.ordinal()
    .range(["steelblue", "#ccc"]);
var color3 = d3.scale.category20(); // category10 category20 category20b category20c

var legendNames = [];

var duration = 750,
    delay = 25;

var _comma = d3.format(",");

var partition = d3.layout.partition().sort(function(a, b) { return d3.ascending(a.name, b.name); })
    .value(function(d) { return d.size; });

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("top");

var svg = svgIn.append("svg").attr("id", "svg"+svgIn.attr('id'))
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var tooltip3g = d3.select("#"+svgIn.attr('id')).append("div").attr("id", "tooltip"+svgIn.attr('id')).attr("class", "tooltipsvg hidden").style("width","200px")
		.html('<p><strong>Category: <span id="group">xxx</span></strong></p><p><strong>Value: <span id="population">xxx</span></strong></p>');
		
var contenttableIn = d3.select("#contenttable"+svgIn.attr('id'));
var navPath = d3.select("#navPath"+svgIn.attr('id')).attr("class", "navPath")
		.html(''); // <span id="group">xxx</span>
		
svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height)
    .on("click", up);

svg.append("g")
    .attr("class", "x axis");

var yAxis = svg.append("g")
    .attr("class", "y axis")
  .append("line")
    .attr("y1", "100%");

//d3.json("readme.json", function(error, root) {
  //if (error) throw error;
  var jsonData = jsonDataIn ; //'{  "name": "top10job",  "children": [   {    "name": "Static Data",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 9},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 24},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 14},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 5},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 4}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 31}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Source File Error",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 54},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 6}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 5},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Config",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 64},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 3},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Operational Error",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 4}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 3}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Increased Volumes",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 2},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Capacity",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 4},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Platform",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 1},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Code/Bug",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	 {      "name": "Finance",      "children": [       {"name": "GST", "size": 3},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "New Release/Bug",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Other",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 3},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 4},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 6}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   }   ] }';
  var root = JSON.parse( jsonData );
  partition.nodes(root);
  x.domain([0, root.value]).nice();
  down(root, 0);
//});

function down(d, i) {
  if (!d.children || this.__transition__) { 
	//console.log(d); 
	if (!!d.content) { contenttableIn.attr("class", "contenttable").html(d.content); 
		} else {  contenttableIn.html(""); }
			return; }

  var nullList = 0;
  d.children.forEach(function(e,idx){ 
	if (!!!e.children) { // !e.children ||  typeof e.children === 'undefined'
		nullList = 1; 
		//if (!!d.content) { contenttableIn.attr("class", "contenttable").html(d.content); } else { contenttableIn.html(""); }
		return; }  
	});
	//if (nullList) return;

  var end = duration + d.children.length * delay;

  //console.log(d.children.length); 
	yAxis.attr("y1", (d.children.length * barHeight * 1.2 * 100 / height )+"%");
	
	navPath.html(navPathBuilder(d));
	
  // Mark any currently-displayed bars as exiting.
  var exit = svg.selectAll(".enter")
      .attr("class", "exit");

  // Entering nodes immediately obscure the clicked-on bar, so hide it.
  exit.selectAll("rect").filter(function(p) { return p === d; })
      .style("fill-opacity", 1e-6);

	  // Update the x-scale domain.
  x.domain([0, d3.max(d.children, function(d) { return d.value; })]).nice();
  
  // Update the x-axis.
  svg.selectAll(".x.axis").transition()
      .duration(duration)
      .call(xAxis);
	  
  // Enter the new bars for the clicked-on data.
  // Per above, entering bars are immediately visible.
  //console.log(d);
  if (!nullList) { 
	var enter2 = bar2(d);
	enter2.forEach(function(e,idx){
		e.attr("transform", stack(i))
		.style("opacity", 1);
	});
       // Have the text fade-in, even though the bars are visible.
	// Color the bars as parents; they will fade to children if appropriate.
	enter2.forEach(function(e,idx){
		e.select("text").style("fill-opacity", 1).style("fill","white"); //1e-6
		e.select("rect").style("fill", function(d,i) { return color(true)}); // color3(d.name); });//
	});
  
	// Transition entering bars to their new position.
	var enterTransition2List=[],enterTransition2; 
	enter2.forEach(function(e,idx){
		enterTransition2 = e.transition()
		.duration(duration)
		.delay(function(d, i) { return i * delay; })
		.attr("transform", stack(idx));
	  
		enterTransition2List.push(enterTransition2);
		});
	  
	legendNames = [];

	// Transition entering rects to the new x-scale.
	enterTransition2List.forEach(function(e,idx){
		e.select("rect")
		 .attr("width", function(d) { if(legendNames.indexOf(d.name) == -1) { legendNames.push(d.name); } //console.log(legendNames,d.name,d.value); 
			return x(d.value); })
		 .style("fill", function(d,i) { return color3(d.name); }); //function(d) { return color(!!d.children); });
	});
  
	legend(legendNames);
  
	}
	
  var enter = bar(d)
      .attr("transform", stack(i))
      .style("opacity", 0);
	  
	  

 
  
  enter.select("text").style("fill-opacity", 1e-6);
  //enter.select("rect").style("fill", function(d,i) { return color(true)}); // color3(d.name); });//
  
  //---

  
	  
  var enterTransition = enter.transition()
      .duration(duration)
      .delay(function(d, i) { return i * delay; })
      .attr("transform", function(d, i) { return "translate(0," + barHeight * i * 1.2 + ")"; }).style("opacity", 1);
	
  // Transition entering text.
  enterTransition.select("text")
      .style("fill-opacity", 1);
	
	

  enterTransition.select("rect")
      .attr("width", function(d) { return x(d.value); })//.style("opacity", 0)
      ;//.style("fill", function(d,i) { return color3(d.name); });//function(d) { return color(!!d.children); });

	  if (!nullList) { enterTransition.select("rect").style("opacity", 0); }
	  else { enterTransition.select("rect").style("fill", function(d,i) { return color3(d.name); }); }
	  
  // Transition exiting bars to fade out.
  var exitTransition = exit.transition()
      .duration(duration)
      .style("opacity", 1e-6)
      .remove();

  // Transition exiting bars to the new x-scale.
  //exitTransition.selectAll("rect").attr("width", function(d) { return x(d.value); });

  // Rebind the current node to the background.
  svg.select(".background")
	.datum(d)
    .transition()
    .duration(end);

  d.index = i;
}

function up(d) {	
  contenttableIn.html("");

  if (!d.parent || this.__transition__) return;
  var end = duration + d.children.length * delay;

  //console.log(d.parent.children.length); 
	yAxis.attr("y1", (d.parent.children.length * barHeight * 1.2 * 100 / height )+"%");

	navPath.html(navPathBuilder(d.parent));
	
  // Mark any currently-displayed bars as exiting.
  var exit = svg.selectAll(".enter")
      .attr("class", "exit");

	  // Update the x-scale domain.
  x.domain([0, d3.max(d.parent.children, function(d) { return d.value; })]).nice();

  // Update the x-axis.
  svg.selectAll(".x.axis").transition()
      .duration(duration)
      .call(xAxis);
	  
	  var enter2 = bar2(d.parent);
  enter2.forEach(function(e,idx){
	e.attr("transform", stack(d.index))
      .style("opacity", 1);
  });
	  
  // Enter the new bars for the clicked-on data's parent.
  var enter = bar(d.parent)
      .attr("transform", function(d, i) { return "translate(0," + barHeight * i * 1.2 + ")"; })
      .style("opacity", 1e-6);

  // Color the bars as appropriate.
  // Exiting nodes will obscure the parent bar, so hide it.
  
  enter2.forEach(function(e,idx){
	e.select("text").style("fill-opacity", 1).style("fill","white"); //1e-6
	e.select("rect").style("fill", function(d,i) { return color(true)}); // color3(d.name); });//
  });
  
  enter.select("rect")
      //.style("fill", function(d,i) { return color3(d.name); }) //function(d) { return color(!!d.children); })
    .filter(function(p) { return p === d; })
      .style("fill-opacity", 1e-6);

  //---

  // Transition entering bars to their new position.
  var enterTransition2List=[],enterTransition2; 
  enter2.forEach(function(e,idx){
	enterTransition2 = e.transition()
      .duration(duration)
      .delay(function(d, i) { return i * delay; })
      .attr("transform", stack(idx));
	  
	  enterTransition2List.push(enterTransition2);
	  });
  
  // Transition entering bars to fade in over the full duration.
  var enterTransition = enter.transition()
      .duration(end)
      .style("opacity", 1);

	  legendNames = [];
	  
	  enterTransition2List.forEach(function(e,idx){
		e.select("rect")
		 .attr("width", function(d) { return x(d.value); }) //console.log(d.name,d.value); 
		 .style("fill", function(d,i) { if (legendNames.indexOf(d.name) == -1) { 
				legendNames.push(d.name);}
			return color3(d.name); });   //function(d) { return color(!!d.children); });
		});
			
	legend(legendNames);
			
  // Transition entering rects to the new x-scale.
  // When the entering parent rect is done, make it visible!
  enterTransition.select("rect")
      .attr("width", function(d) { return x(d.value); }).style("opacity", 0)
      .each("end", function(p) { if (p === d) d3.select(this).style("fill-opacity", null); });

  // Transition exiting bars to the parent's position.
  var exitTransition = exit.selectAll("g").transition()
      .duration(duration)
      .delay(function(d, i) { return i * delay; })
      .attr("transform", stack(d.index));

  // Transition exiting text to fade out.
  exitTransition.select("text")
      .style("fill-opacity", 1e-6);

  // Transition exiting rects to the new scale and fade to parent color.
  exitTransition.select("rect")
      .attr("width", function(d) { return x(d.value); })
      .style("fill", function(d,i) { return color3(d.name); }); //color(true));

  // Remove exiting nodes when the last child has finished transitioning.
  exit.transition()
      .duration(end)
      .remove();
	
  // Rebind the current parent to the background.
  svg.select(".background")
      .datum(d.parent)
    .transition()
      .duration(end);
}


// Creates a set of bars for the given data node, at the specified index.
function bar(d) {
	var nullList = 0;
    /*d.children.forEach(function(e,idx){ e.children.forEach(function(e1,idx1){ 
	if (!e1.children ||  typeof e1.children === 'undefined') {nullList = 1; return;} });
	if (nullList) return;
	});*/
	
  var bar = svg.insert("g", ".y.axis")
      .attr("class", "enter")
      .attr("transform", "translate(0,5)")
    .selectAll("g")
      .data(d.children)
    .enter().append("g")
      .style("cursor", function(d) { return ( nullList || !d.children ) ? null : "pointer"; })
      .on("click", down);

  bar.append("text")
      .attr("x", -6)
      .attr("y", barHeight / 2)
      .attr("dy", ".35em")
	  .style("font-size", width/85+"px")
      .style("text-anchor", "end")
      .text(function(d) { return matchMonth(d.name); });

  bar.append("rect")
      .attr("width", function(d) { return x(d.value); })
      .attr("height", barHeight)//;
	  .on('mouseover',function(d,i) {
                            // update position n value
							//console.log( window.pageXOffset , window.pageYOffset );
                         var tt3g = tooltip3g
									.style("left", Math.max(0,(d3.event.pageX - window.pageXOffset + 20))+ 'px') 
									.style("top", (d3.event.pageY - window.pageYOffset + 15) + 'px');
							
                            tt3g.select("#group").text(matchMonth(d.name));
							tt3g.select("#population").text(_comma(d.value));
                            // display DIV
                            tt3g.classed("hidden", false);
			   })
	  .on('mouseout',function() {
			   tooltip3g.classed("hidden", true);
			   });


  return bar;
}


// Creates a set of bars for the given data node, at the specified index.
function bar2(d) {
	var bar, barList=[] ;
	d.children.forEach(function(e,idx){
	bar = svg.insert("g", ".y.axis")
		.attr("class", "enter")
		.attr("transform", "translate(0,5)")
		.selectAll("g")
		.data(e.children)
		.enter().append("g")
		//.style("cursor", function(d) { return !d.children ? null : "pointer"; })
		;//.on("click", down);
		
		

  bar.append("rect")
      .attr("width", function(d) { return x(d.value); })
      .attr("height", barHeight);
	  
	  bar.append("text")
	  .attr("x", function(d) { return x(d.value)/2 + 3; })
      .attr("y", barHeight / 2)
      .attr("dy", ".35em")
	  .style("font-size", width/65+"px")
      .style("text-anchor", "end")
      .text(function(d) { return d.value; });
	  
	  
	  /*
	  .on('mouseover',function(d,i) {
                            // update position n value
                         var tt3g = d3.select("#tooltip3g")
                            .style("left", (d3.event.pageX - 20)+ 'px') 
                            .style("top", (d3.event.pageY + 15) + 'px');
							
                            tt3g.select("#group").text(d.name);
							tt3g.select("#population").text(_comma(d.value));
                            // display DIV
                            d3.select("#tooltip3g").classed("hidden", false);
			   })
	  .on('mouseout',function() {
			   d3.select("#tooltip3g").classed("hidden", true);
			   });*/
	
	barList.push(bar);
	
	});
	
	/*
  var bar = svg.insert("g", ".y.axis")
      .attr("class", "enter")
      .attr("transform", "translate(0,5)")
    .selectAll("g")
      .data(d.children.children)
    .enter().append("g")
      .style("cursor", function(d) { return !d.children ? null : "pointer"; })
      ;//.on("click", down);*/

  


  return barList;
}

// A stateful closure for stacking bars horizontally.
function stack(i) {
  var x0 = 0;
  return function(d) {
    var tx = "translate(" + x0 + "," + barHeight * i * 1.2 + ")";
    x0 += x(d.value);
    return tx;
  };
}

function legend(legendArr) { 
legendArr.sort(function(b,a) {return (a > b) ? 1 : ((b > a) ? -1 : 0);} );
var arrSize = legendArr.length;
var px = 950, py = 300, gap = 80; px = width, py = height/2;
// max len 25 char  
var maxLen = d3.max(legendArr, function(d) { return String(d).length; })
gap = 4*maxLen+50;

//svg.selectAll(".legend").remove();

var legend3g = svg.selectAll(".legend")
      .data(legendArr.slice().reverse())
	  .enter().append("g")
      .attr("class", "legend enter")
      .attr("transform", function(d, i) { return "translate("+ ( 80 - (((i)/7) | 0)*gap ) +"," + ( py + ( ( (i)%7 )*20) ) + ")"; });

  legend3g.append("rect")
      .attr("x", function(d, i) { return px + 5 ; } )
      .attr("width", px/50)
      .attr("height", py/15)
      .style("fill", function(d,i) { return color3(d); });

  legend3g.append("text")
      .attr("x", function(d, i) { return px ; } )
      .attr("y", py/30)
	  .style("font-size", px/95+"px")
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d; });
	  
	
}

function matchMonth(strMonth) {
	var mapMonth = { "01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun",
		"07":"Jul","08":"Aug","09":"Feb","10":"Oct","11":"Nov","12":"Dec"
		};
	var str = strMonth;
	var matches = String(strMonth).match(/(\d{4})-(\d{2})/); // 2014-01 
	if (matches) {
    // matches[1] = digits of first number
    // matches[2] = digits of second number
	str = matches[1] + '-' + mapMonth[matches[2]];
	}
	return str;
	}

function navPathBuilder(d) {
	//console.log(d); 
	if (!d.parent || this.__transition__) return '';
	return navPathBuilder(d.parent) +' -> ' + matchMonth(d.name);
	}

}


document.addEventListener("DOMContentLoaded", function(event) { 
    var jsonData = '{  "name": "top10job",  "children": [   {    "name": "Static Data",    "children": [     {      "name": "Asset Mgmt",  "content": "<table><tr><th>Year</th><th>APP Code Group</th><th>Month</th><th>App Code</th><th>Status</th><th>SLA Met</th> <th>Op Cat 3</th><th>Incident ID</th><th>Reported Date</th><th>Actual Resolution Date</th><th>Severity</th><th>Ticket Duration</th><th>Job Name</th> <th>Host Name</th><th>Summary</th><th>Event Summary</th><th>Impact</th><th>Action Taken</th><th>Cause Level 1</th> <th>Cause Level 2</th><th>Organization</th></tr></table>",    "children": [       {"name": "AMS", "size": 9, "content": "contents---"},       {"name": "CDO", "size": 12, "content": "content..."},       {"name": "EDM", "size": 24},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse", "content":"content.",  "children": [       {"name": "BBD", "size": 14},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 5},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 4}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 31}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Source File Error",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 54},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 6}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 5},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Config",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 64},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 3},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Operational Error",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 4}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 3}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Increased Volumes",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 2},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Capacity",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 4},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Platform",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 1},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Code/Bug",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	 {      "name": "Finance",      "children": [       {"name": "GST", "size": 3},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "New Release/Bug",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Other",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 3},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 4},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 6}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   }   ] }';
	var svgElement = d3.select("#top10job");
	drawtop10job(svgElement, jsonData);
	
});
</script>
</body>
</html>
