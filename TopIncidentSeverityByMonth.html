<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Top Religion By Month</title>
</head>
<style>

text {
  font: 16px sans-serif;
}

rect.background {
  fill: white;
}

.axis {
  shape-rendering: crispEdges;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
}

.hidden text {
			display: none;
		}

  .tooltipsvg {
            position: absolute;
            width: 100px;
            height: auto;
            padding: 10px;
            background-color: white;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            pointer-events: none;
			left: 80%;
			-moz-transform: translate(-80%, 0);
			-webkit-transform: translate(-80%, 0);
			transform: translate(-80%, 0);
		}
  .tooltipsvg.hidden {
			display: none;
		}
  .tooltipsvg p {
             margin: 0;
             font-family: sans-serif;
             font-size: 12px;
             line-height: 20px;
		}

</style>
<body>
<div><p><h3>Top Religion By Month</h3></p></div>
<br>
<div id="navPathtop10sev"></div>
<br>
<div id="top10sev"></div>
<div></div>
<br />
<div id="contenttabletop10sev"></div>
<br />
<div></div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.1/underscore-min.js" charset="utf-8">
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.9/d3.min.js" charset="utf-8">
		// src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.9/d3.min.js"   src="d3/d3.v3.js"
		// <script src="./d3.v3.min.js"> </ script>
		// <script src="./underscore-min.js"></ script>
		</script>
<script>


function drawtop10svrt(svgIn, jsonDataIn) { 

//String.prototype.hashCode = 
function hashCode(str) {
  var hash = 0, i, chr, len;
  if (str.length === 0) return hash;
  for (i = 0, len = str.length; i < len; i++) {
    chr   = str.charCodeAt(i);
    hash  = ((hash << 5) - hash) + chr;
    hash |= 0; // Convert to 32bit integer
  }
  return Math.abs(hash);
} //;

function getColor(idx) {
		var id = isNaN(idx) ? hashCode(idx) : idx ;
                var palette = [
                   "#0a72ff", "#1eff06", "#ff1902", "#ffe304", "#0d8c39", 
				   "#0f83aa", "#ba5f59", "#c602fe", "#f2affd", "#11fee3", 
				   "#8e7808", "#b7ff78", "#fe8f06", "#7b8f70", "#f00755", 
				   "#b14ece", "#feb87c", "#8fe7fd", "#8f6f92", "#0eff9f", 
				   "#74a2fd", "#08b401", "#ffbac4", "#fd75aa", "#c3cd7a", 
				   "#fe6e4c", "#77a009", "#aeff04", "#05aba2", "#a8feb7", 
				   "#fe32e8", "#bfc0ea", "#eab739", "#b56520", 
				   '#2ec7c9', 
				   '#b6a2de', '#5ab1ef', '#ffb980', '#d87a80', '#8d98b3', 
				   '#e5cf0d', '#97b552', '#95706d', '#dc69aa', '#07a2a4', 
				   '#9a7fd1', '#588dd5', '#f5994e', '#c05050', '#59678c', 
				   '#c9ab00', '#7eb00a', '#6f5553', '#c14089'
                ]
                return palette[id % palette.length];
            } 

var margin = {top: 30, right: 120, bottom: 120, left: 120},
    width = 640 - margin.left - margin.right, //960 1260
    height = 450 - margin.top - margin.bottom; // 700 

var padding = 20;

var y = d3.scale.linear()
    .range([height, 0]);

var barHeight = 50;
var barHeightMax = 80;
var barHeightMin = 30;
var fontSizeMin = 10;

var color = d3.scale.ordinal()
    .range(["steelblue", "#ccc"]);
var color3 = d3.scale.category20(); // category10 category20 category20b category20c

var legendNames = [];

var duration = 750,
    delay = 25;

var _comma = d3.format(",");

var partition = d3.layout.partition().sort(function(a, b) { return d3.ascending(a.name, b.name); })
    .value(function(d) { return d.size; });

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var svg = svgIn.append("svg").attr("id", "svg"+svgIn.attr('id'))
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
	.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var tooltip3g = d3.select("#"+svgIn.attr('id')).append("div").attr("id", "tooltip"+svgIn.attr('id')).attr("class", "tooltipsvg hidden").style("width","200px")
		.html('<p><strong>Category: <span id="group">xxx</span></strong></p><p><strong>Value: <span id="population">xxx</span></strong></p>');
		
var contenttableIn = d3.select("#contenttable"+svgIn.attr('id'));
var navPath = d3.select("#navPath"+svgIn.attr('id')).attr("class", "navPath")
		.html(''); // <span id="group">xxx</span>

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height)
    .on("click", up);

svg.append("g")
    .attr("class", "y axis")
	.append("text")
	.attr("transform", "rotate(-90)")
	.attr("y", -80)
	.attr("x", -50)
	.attr("dy", ".71em")
	.style("text-anchor", "end")
	.text("Incident #s");

xAxis = svg.append("g")
    .attr("class", "x axis")
  .append("line")
    .attr("x1", "100%")
	.attr("transform", "translate(0," + height + ")");

//d3.json("readme.json", function(error, root) {
  //if (error) throw error;
  var jsonData = jsonDataIn ; //'{  "name": "top10job",  "children": [   {    "name": "Static Data",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 9},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 24},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 14},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 5},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 4}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 31}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Source File Error",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 54},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 6}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 5},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Config",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 64},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 3},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Operational Error",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 4}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 3}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Increased Volumes",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 2},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Capacity",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 4},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Platform",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 1},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Code/Bug",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	 {      "name": "Finance",      "children": [       {"name": "GST", "size": 3},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "New Release/Bug",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 39},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 34},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 16}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   },   {    "name": "Other",    "children": [     {      "name": "Asset Mgmt",      "children": [       {"name": "AMS", "size": 3},       {"name": "CDO", "size": 12},       {"name": "EDM", "size": 14},       {"name": "POM", "size": 7}      ]     },     {      "name": "Data Warehouse",      "children": [       {"name": "BBD", "size": 4},       {"name": "CSM", "size": 31},       {"name": "DBM", "size": 8},       {"name": "IFD", "size": 14},       {"name": "SMD", "size": 6}      ]     },     {      "name": "Enterprise",      "children": [       {"name": "ALM", "size": 4}, 	  {"name": "ERM", "size": 7}      ]     }, 	{      "name": "Finance",      "children": [       {"name": "GST", "size": 53},       {"name": "PEM", "size": 31},       {"name": "HKM", "size": 7},       {"name": "NOS", "size": 16}      ]     }, 	{      "name": "GMIM",      "children": [       {"name": "DVP", "size": 7}, 	  {"name": "DVR", "size": 4}, 	  {"name": "REU", "size": 14}      ]     }, 	{      "name": "Private Bank",      "children": [       {"name": "PBD", "size": 11}, 	  {"name": "PBI", "size": 13}      ]     }, 	{      "name": "Risk Mgmt",      "children": [       {"name": "CCR", "size": 32},       {"name": "CEL", "size": 21},       {"name": "GRC", "size": 15},       {"name": "RSM", "size": 27}      ]     }    ]   }   ] }';
  var root = JSON.parse( jsonData );
  partition.nodes(root);
  y.domain([0, root.value]).nice();
  down(root, 0);
//});

function down(d, i) {
  if (!d.children || this.__transition__) { 
	if (!!d.content) { contenttableIn.attr("class", "contenttable").html(d.content); 
		} else {  contenttableIn.html(""); }
			return; }
 //console.log(d); 
  var nullList = 0;
  d.children.forEach(function(e,idx){ 
	if (!!!e.children) { // !e.children ||  typeof e.children === 'undefined'
		nullList = 1; 
		//if (!!d.content) { contenttableIn.attr("class", "contenttable").html(d.content); } else { contenttableIn.html(""); }
		return; }  
	});
	//if (nullList) return;

  var end = duration + d.children.length * delay;
	
	barHeight = (width / (1.5*d.children.length)) > barHeightMax ? barHeightMax : ( (width / (1.5*d.children.length)) < barHeightMin ? barHeightMin : (width / (1.5*d.children.length)) ) ;
	var totalHeight = d.children.length * barHeight * 1.2 + 2 * padding ;
	xAxis.attr("x1", ( ( totalHeight - 2 * padding ) / width )* 100 +"%");
	navPath.html(navPathBuilder(d));
		
  // Mark any currently-displayed bars as exiting.
  var exit = svg.selectAll(".enter")
      .attr("class", "exit");

  // Entering nodes immediately obscure the clicked-on bar, so hide it.
  exit.selectAll("rect").filter(function(p) { return p === d; })
      .style("fill-opacity", 1e-6);

	  // Update the x-scale domain.
  y.domain([0, d3.max(d.children, function(d) { return d.value; })]).nice();
  
  // Update the x-axis.
  svg.selectAll(".y.axis").transition()
      .duration(duration)
      .call(yAxis);
	

  if (!nullList) { 
  // Enter the new bars for the clicked-on data.
  // Per above, entering bars are immediately visible.
  //console.log(d);
	var enter2 = bar2(d);
	enter2.forEach(function(e,idx){
		//.attr("transform", stack(i))
		e.style("opacity", 1);
	});
      
	  // Have the text fade-in, even though the bars are visible.
	// Color the bars as parents; they will fade to children if appropriate.
	enter2.forEach(function(e,idx){
		e.select("text").style("fill-opacity", 1).style("fill","white"); //1e-6
		e.select("rect").style("fill", function(d,i) { return color(true)}); // color3(d.name); });//
	});
  
  
	// Transition entering bars to their new position.
	var enterTransition2List=[],enterTransition2; 
	enter2.forEach(function(e,idx){
		enterTransition2 = e.transition()
		.duration(duration)
		.delay(function(d, i) { return i * delay; })
		;//.attr("transform", stack(idx));
	  
	  enterTransition2List.push(enterTransition2);
	  });
	  
	  legendNames = [];

	// Transition entering rects to the new x-scale.
	enterTransition2List.forEach(function(e,idx){
		e.select("text").attr("transform", stack2(idx) );
		
		e.select("rect")
		 .attr("height", function(d) { if(legendNames.indexOf(d.name) == -1) { legendNames.push(d.name); } //console.log(legendNames,d.name,d.value); 
			return height - y(d.value); }) // height - y(d.value) 
		 .attr("transform", stack2(idx))
		 .style("fill", function(d,i) { return color3(d.name); }); //function(d) { return color(!!d.children); });
	});
  
	legend(legendNames, totalHeight);
  
	}
	
  var enter = bar(d)
      .attr("transform", stack(i))
      .style("opacity", 0);
	  
	  

  
  
  enter.select("text").style("fill-opacity", 1e-6);//.attr("transform", "rotate(-90)");
  //enter.select("rect").style("fill", function(d,i) { return color(true)}); // color3(d.name); });//
  
  //---

	  
  var enterTransition = enter.transition()
      .duration(duration)
      .delay(function(d, i) { return i * delay; })
      .attr("transform", function(d, i) { return "translate(" + barHeight * i * 1.2 + ",0)"; }).style("opacity", 1);
	
  // Transition entering text.
  enterTransition.select("text")
      .style("fill-opacity", 1).attr("transform", "rotate(-90)");
	
	

  enterTransition.select("rect")
      .attr("height", function(d) { return height - y(d.value); })//.style("opacity", 0)
      ;//.style("fill", function(d,i) { return color3(d.name); });//function(d) { return color(!!d.children); });
	
	if (!nullList) { enterTransition.select("rect").style("opacity", 0); }
	  else { enterTransition.select("rect").style("fill", function(d,i) { return color3(d.name); }); }
	  
  // Transition exiting bars to fade out.
  var exitTransition = exit.transition()
      .duration(duration)
      .style("opacity", 1e-6)
      .remove();

  // Transition exiting bars to the new x-scale.
  //exitTransition.selectAll("rect").attr("height", function(d) { return y(d.value); });

  // Rebind the current node to the background.
  svg.select(".background")
	.datum(d)
    .transition()
    .duration(end);

  d.index = i;
}

function up(d) {
  contenttableIn.html("");
  
  if (!d.parent || this.__transition__) return;
  var end = duration + d.children.length * delay;

	barHeight = (width / (1.5*d.parent.children.length)) > barHeightMax ? barHeightMax : ( (width / (1.5*d.parent.children.length)) < barHeightMin ? barHeightMin : (width / (1.5*d.parent.children.length)) );
	var totalHeight = d.parent.children.length * barHeight * 1.2 + 2 * padding ;
	xAxis.attr("x1", ( ( totalHeight - 2 * padding ) / width )* 100 +"%");
	navPath.html(navPathBuilder(d.parent));
	
  // Mark any currently-displayed bars as exiting.
  var exit = svg.selectAll(".enter")
      .attr("class", "exit");

	  // Update the x-scale domain.
  y.domain([0, d3.max(d.parent.children, function(d) { return d.value; })]).nice();

  // Update the x-axis.
  svg.selectAll(".y.axis").transition()
      .duration(duration)
      .call(yAxis);
	  
	  var enter2 = bar2(d.parent);
  enter2.forEach(function(e,idx){
	//e.attr("transform", stack(d.index))
      e.style("opacity", 1);
  });
	  
  // Enter the new bars for the clicked-on data's parent.
  var enter = bar(d.parent)
      .attr("transform", function(d, i) { return "translate(" + barHeight * i * 1.2 + ",0)"; })
      .style("opacity", 1e-6);

  // Color the bars as appropriate.
  // Exiting nodes will obscure the parent bar, so hide it.
  
  enter2.forEach(function(e,idx){
	e.select("text").style("fill-opacity", 1).style("fill","white"); //1e-6
	e.select("rect").style("fill", function(d,i) { return color(true)}); // color3(d.name); });//
  });
  
  enter.select("rect")
      //.style("fill", function(d,i) { return color3(d.name); }) //function(d) { return color(!!d.children); })
    .filter(function(p) { return p === d; })
      .style("fill-opacity", 1e-6);
	
  //---

  // Transition entering bars to their new position.
  var enterTransition2List=[],enterTransition2; 
  enter2.forEach(function(e,idx){
	enterTransition2 = e.transition()
      .duration(duration)
      .delay(function(d, i) { return i * delay; })
      ;//.attr("transform", stack(idx));
	  
	  enterTransition2List.push(enterTransition2);
	  });
  
  // Transition entering bars to fade in over the full duration.
  var enterTransition = enter.transition()
      .duration(end)
      .style("opacity", 1);

	  legendNames = [];
	  
	  enterTransition2List.forEach(function(e,idx){
		e.select("text").attr("transform", stack2(idx));
		
		e.select("rect")
		 .attr("height", function(d) { return height - y(d.value); }) //console.log(d.name,d.value); 
		 .attr("transform", stack2(idx))
		 .style("fill", function(d,i) { if (legendNames.indexOf(d.name) == -1) { 
				legendNames.push(d.name);}
			return color3(d.name); });   //function(d) { return color(!!d.children); });
		});
			
	legend(legendNames,totalHeight);
			
	enterTransition.select("text")
      .style("fill-opacity", 1).attr("transform", "rotate(-90)");
	  
  // Transition entering rects to the new x-scale.
  // When the entering parent rect is done, make it visible!
  enterTransition.select("rect")
      .attr("height", function(d) { return height - y(d.value); }).style("opacity", 0)
      .each("end", function(p) { if (p === d) d3.select(this).style("fill-opacity", null); });

  // Transition exiting bars to the parent's position.
  var exitTransition = exit.selectAll("g").transition()
      .duration(duration)
      .delay(function(d, i) { return i * delay; })
      .attr("transform", stack(d.index));

  // Transition exiting text to fade out.
  exitTransition.select("text")
      .style("fill-opacity", 1e-6);

  // Transition exiting rects to the new scale and fade to parent color.
  exitTransition.select("rect")
      .attr("height", function(d) { return y(d.value); })
      .style("fill", function(d,i) { return color3(d.name); }); //color(true));

  // Remove exiting nodes when the last child has finished transitioning.
  exit.transition()
      .duration(end)
      .remove();
	
  // Rebind the current parent to the background.
  svg.select(".background")
      .datum(d.parent)
    .transition()
      .duration(end);
}


// Creates a set of bars for the given data node, at the specified index.
function bar(d) {
	var nullList = 0;
    /*d.children.forEach(function(e,idx){ e.children.forEach(function(e1,idx1){ 
	if (!e1.children ||  typeof e1.children === 'undefined') {nullList = 1; return;} });
	if (nullList) return;
	});*/

  var bar = svg.insert("g", ".x.axis")
      .attr("class", "enter")
      .attr("transform", "translate("+padding+",0)")
    .selectAll("g")
      .data(d.children)
    .enter().append("g")
      .style("cursor", function(d) { return ( nullList || !d.children ) ? null : "pointer"; })
      .on("click", down);

  bar.append("text")
      .attr("x", -(height+10))
      .attr("y", barHeight / 2)
      .attr("dx", ".35em")
	  .attr("dy", ".35em")
	  .style("font-size", ( (width/85) > fontSizeMin ? (width/85) : fontSizeMin ) +"px")
      .style("text-anchor", "end")
	  //.style("writing-mode", "tb")
	  //.attr("transform", "rotate(-90)")
      .text(function(d) { return matchMonth(d.name); });

  bar.append("rect")
	  .attr("id", function(d) { return d.name; } )
      .attr("width", barHeight)
      .attr("height", function(d) { return height - y(d.value); })
	  .attr("y", function(d) { return y(d.value); })
	  .on('mouseover',function(d,i) {
                            // update position n value
							//console.log( window.pageXOffset , window.pageYOffset );
						var cr = getCoords(document.getElementById(d.name),document.getElementById("svg"+svgIn.attr('id')));
                         var tt3g = tooltip3g.style("left", Math.max(0,cr.left)+ 'px') 
											.style("top", cr.top + 'px');

                            //.style("left", Math.max(0,(d3.event.pageX - window.pageXOffset + 20))+ 'px') 
                            //.style("top", (d3.event.pageY - window.pageYOffset + 15) + 'px');
							//console.log( d3.event.pageX , d3.event.pageY );
							
                            tt3g.select("#group").text(matchMonth(d.name));
							tt3g.select("#population").text(_comma(d.value));
                            // display DIV
                            tt3g.classed("hidden", false);
			   })
	  .on('mouseout',function() {
			   tooltip3g.classed("hidden", true);
			   });


  return bar;
}

function getCoords(elm,svgelm) { 
	var el = elm.getBoundingClientRect(),
	svg1 = svgelm.getBoundingClientRect(); 
	//console.log( el.left , el.top );
	return {
           left: d3.event.pageX-svg1.left, // el.left-svg1.left, 
           top: d3.event.pageY-svg1.top // el.top-svg1.top 
         }
}

// Creates a set of bars for the given data node, at the specified index.
function bar2(d) {
	var bar, barList=[] ;
	d.children.forEach(function(e,idx){
	bar = svg.insert("g", ".x.axis")
		.attr("class", "enter")
		.attr("transform", "translate("+padding+",0)")
		.selectAll("g")
		.data(e.children)
		.enter().append("g")
		//.style("cursor", function(d) { return !d.children ? null : "pointer"; })
		;//.on("click", down);
		
		

  bar.append("rect")
      .attr("width", barHeight)
	  //.attr("y", function(d) { return y(d.value); })
      .attr("height", function(d) { return height - y(d.value); });
	  
	  bar.append("text")
      .attr("x", barHeight / 2 - 5 )
      .attr("y", function(d) { return (height - y(d.value))/2 ; })
      .attr("dy", ".35em")
	  .attr("dx", ".35em")
	  .style("font-size", ( (width/65) > fontSizeMin ? (width/65) : fontSizeMin ) +"px")
      .style("text-anchor", "middle") // start end middle 
      .text(function(d) { return d.value; });
	  
	  
	  /*
	  .on('mouseover',function(d,i) {
                            // update position n value
                         var tt3g = d3.select("#tooltip3g")
                            .style("left", (d3.event.pageX - 20)+ 'px') 
                            .style("top", (d3.event.pageY + 15) + 'px');
							
                            tt3g.select("#group").text(d.name);
							tt3g.select("#population").text(_comma(d.value));
                            // display DIV
                            d3.select("#tooltip3g").classed("hidden", false);
			   })
	  .on('mouseout',function() {
			   d3.select("#tooltip3g").classed("hidden", true);
			   });*/
	
	barList.push(bar);
	
	});
	
	/*
  var bar = svg.insert("g", ".y.axis")
      .attr("class", "enter")
      .attr("transform", "translate(0,5)")
    .selectAll("g")
      .data(d.children.children)
    .enter().append("g")
      .style("cursor", function(d) { return !d.children ? null : "pointer"; })
      ;//.on("click", down);*/

  


  return barList;
}

// A stateful closure for stacking bars horizontally.
function stack(i) {
  var x0 = 0;
  return function(d) {
    var tx = "translate(" + barHeight * i * 1.2 + "," + x0 + ")";
    x0 += (y(d.value)); // (height - y(d.value))
    return tx;
  };
}

function stack2(i, ind) {
  var x0 = 0;
  return function(d) {
    var tx = "translate(" + barHeight * i * 1.2 + "," + ( y(d.value) - x0 )+ ")";
    x0 += (height - y(d.value)); // (height - y(d.value))
	if(!!ind) { tx = "rotate(-90," + barHeight * i * 1.2 + "," + ( y(d.value) - x0 )+ ")"; }
    return tx;
  };
}

function legend(legendArr, startX) {

legendArr.sort(function(b,a) {return (a > b) ? 1 : ((b > a) ? -1 : 0);} );

var arrSize = legendArr.length, legengNum = 12;

var gap = 80, px = width, py = height/2;
// max len 25 char  
var maxLen = d3.max(legendArr, function(d) { return String(d).length; })
gap = 4*maxLen+50;

//svg.selectAll(".legend").remove();

var legend3g = svg.selectAll(".legend")
      .data(legendArr.slice().reverse())
	  .enter().append("g")
      .attr("class", "legend enter")
      .attr("transform", function(d, i) { return "translate("+ ( startX + ( (i/legengNum) | 0)*gap ) +"," + ( 0 + ( ( i%legengNum )*20) ) + ")"; });

  legend3g.append("rect")
      //.attr("x", function(d, i) { return px + 5 ; } )
      .attr("width", px/50)
      .attr("height", py/15)
      .style("fill", function(d,i) { return color3(d); });

  legend3g.append("text")
      .attr("x", function(d, i) { return px/50 + 2; } )
      .attr("y", py/30)
	  .style("font-size", ( (px/95) > fontSizeMin ? (px/95) : fontSizeMin ) +"px")
      .attr("dy", ".35em")
      .style("text-anchor", "start")
      .text(function(d) { return d; });
	  
	
}

function matchMonth(strMonth) {
	var mapMonth = { "01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun",
		"07":"Jul","08":"Aug","09":"Feb","10":"Oct","11":"Nov","12":"Dec"
		};
	var str = strMonth;
	var matches = String(strMonth).match(/(\d{4})-(\d{2})/); // 2014-01 
	if (matches) {
    // matches[1] = digits of first number
    // matches[2] = digits of second number
	str = matches[1] + '-' + mapMonth[matches[2]];
	}
	return str;
	}

function navPathBuilder(d) {
	//console.log(d); 
	if (!d.parent || this.__transition__) return '';
	return navPathBuilder(d.parent) +' -> ' + matchMonth(d.name);
	}

}


document.addEventListener("DOMContentLoaded", function(event) {
	
	//d3.csv("sev.csv", function(error, data) {
	var data = JSON.parse('[{"yearMonth":"1945-04","busgrp":"Buddhism","appgrp":"Other","size":"120","content":"ee---etw","name":"w"},{"yearMonth":"1945-04","busgrp":"Buddhism","appgrp":"Anglican","size":"70","content":"ee---etw","name":"e"},{"yearMonth":"1945-04","busgrp":"Buddhism","appgrp":"Catholic","size":"90","content":"ee---etw","name":"r"},{"yearMonth":"1945-04","busgrp":"Christianity","appgrp":"Orthodox","size":"110","content":"jjj","name":"t"},{"yearMonth":"1945-04","busgrp":"Christianity","appgrp":"Other","size":"120","content":"jjj","name":"w"},{"yearMonth":"1945-04","busgrp":"Christianity","appgrp":"Mahayana","size":"130","content":"jjj","name":"e"},{"yearMonth":"1945-04","busgrp":"Christianity","appgrp":"Ibadhi","size":"20","content":"jjj","name":"r"},{"yearMonth":"1945-04","busgrp":"Christianity","appgrp":"Shia","size":"120","content":"jjj","name":"t"},{"yearMonth":"1945-04","busgrp":"Christianity","appgrp":"Sunni","size":"70","content":"jjj","name":"w"},{"yearMonth":"1945-02","busgrp":"Judaism","appgrp":"Conservative","size":"90","content":"jjj","name":"e"},{"yearMonth":"1945-02","busgrp":"Judaism","appgrp":"Orthodox","size":"110","content":"ggg","name":"r"},{"yearMonth":"1945-02","busgrp":"Judaism","appgrp":"Other","size":"120","content":"ggg","name":"t"},{"yearMonth":"1945-02","busgrp":"Judaism","appgrp":"Reform","size":"130","content":"ggg","name":"w"},{"yearMonth":"1945-02","busgrp":"Buddhism","appgrp":"Other","size":"20","content":"ggg","name":"e"},{"yearMonth":"1945-02","busgrp":"Buddhism","appgrp":"Theravada","size":"120","content":"hhhh","name":"r"},{"yearMonth":"1945-02","busgrp":"Christianity","appgrp":"Anglican","size":"70","content":"hhhh","name":"t"},{"yearMonth":"1945-02","busgrp":"Christianity","appgrp":"Catholic","size":"90","content":"hhhh","name":"w"},{"yearMonth":"1945-02","busgrp":"Christianity","appgrp":"Orthodox","size":"110","content":"hhhh","name":"e"},{"yearMonth":"1945-02","busgrp":"Christianity","appgrp":"Other","size":"120","content":"hhhh","name":"r"}]');

		console.log(JSON.stringify(data));
        _.each(data, function(element, index, list){
            element.size = +element.size;
			console.log(JSON.stringify(element));
        });
	
	var preppedData = genJSON(data, ['yearMonth', 'busgrp','appgrp'])
	preppedData["name"]="top10sev";
	console.log(JSON.stringify(preppedData));
	
    var jsonData = JSON.stringify(preppedData);//'{     "name":"top10sev",    "children": [    {"name":"2015-04",    "children":[ {           "name":"Static Data",          "children":[              {                 "name":"Asset Mgmt",                "content":"...",                "children":[                    {                       "name":"AMS",                      "size":1009,                      "content":"contents---"                   },                   {                       "name":"CDO",                      "size":12,                      "content":"content..."                   },                   {                       "name":"EDM",                      "size":24                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "content":"content.",                "children":[                    {                       "name":"BBD",                      "size":14                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":5                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":4                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":31                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Source File Error",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":54                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":6                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":5                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Config",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":64                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":3                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Operational Error",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":4                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":3                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Increased Volumes",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":2                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Capacity",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":4                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Platform",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":1                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Code/Bug",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":3                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"New Release/Bug",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Other",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":3                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":4                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":6                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       }    ]    },    {    "name":"2015-02",    "children":[        {           "name":"Static Data",          "children":[              {                 "name":"Asset Mgmt",                "content":"...",                "children":[                    {                       "name":"AMS",                      "size":9,                      "content":"contents---"                   },                   {                       "name":"CDO",                      "size":12,                      "content":"content..."                   },                   {                       "name":"EDM",                      "size":24                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "content":"content.",                "children":[                    {                       "name":"BBD",                      "size":14                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":5                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":4                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":31                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Source File Error",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":54                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":6                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":5                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Config",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":64                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":3                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Operational Error",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":4                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":3                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Increased Volumes",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":2                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Capacity",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":4                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Platform",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":1                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Code/Bug",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":3                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"New Release/Bug",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":39                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":34                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":16                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       },       {           "name":"Other",          "children":[              {                 "name":"Asset Mgmt",                "children":[                    {                       "name":"AMS",                      "size":3                   },                   {                       "name":"CDO",                      "size":12                   },                   {                       "name":"EDM",                      "size":14                   },                   {                       "name":"POM",                      "size":7                   }                ]             },             {                 "name":"Data Warehouse",                "children":[                    {                       "name":"BBD",                      "size":4                   },                   {                       "name":"CSM",                      "size":31                   },                   {                       "name":"DBM",                      "size":8                   },                   {                       "name":"IFD",                      "size":14                   },                   {                       "name":"SMD",                      "size":6                   }                ]             },             {                 "name":"Enterprise",                "children":[                    {                       "name":"ALM",                      "size":4                   },                   {                       "name":"ERM",                      "size":7                   }                ]             },             {                 "name":"Finance",                "children":[                    {                       "name":"GST",                      "size":53                   },                   {                       "name":"PEM",                      "size":31                   },                   {                       "name":"HKM",                      "size":7                   },                   {                       "name":"NOS",                      "size":16                   }                ]             },             {                 "name":"GMIM",                "children":[                    {                       "name":"DVP",                      "size":7                   },                   {                       "name":"DVR",                      "size":4                   },                   {                       "name":"REU",                      "size":14                   }                ]             },             {                 "name":"Private Bank",                "children":[                    {                       "name":"PBD",                      "size":11                   },                   {                       "name":"PBI",                      "size":13                   }                ]             },             {                 "name":"Risk Mgmt",                "children":[                    {                       "name":"CCR",                      "size":32                   },                   {                       "name":"CEL",                      "size":21                   },                   {                       "name":"GRC",                      "size":15                   },                   {                       "name":"RSM",                      "size":27                   }                ]             }          ]       }    ]    }    ] }';
	var svgElement = d3.select("#top10sev");
	drawtop10svrt(svgElement,jsonData);
	
	
	//*************************************************
        // THE FUNCTION
        //*************************************************
        function genJSON(csvData, groups) {

          var genGroups = function(data) {
            return _.map(data, function(element, index) {
              return { name : index, children : element };
            });
          };

          var nest = function(node, curIndex) {
            if (curIndex === 0) {
              node.children = genGroups(_.groupBy(csvData, groups[0]));
              _.each(node.children, function (child) {
                nest(child, curIndex + 1);
              });
            }
            else {
              if (curIndex < groups.length) {
                node.children = genGroups(
                  _.groupBy(node.children, groups[curIndex])
                );
                _.each(node.children, function (child) {
                  nest(child, curIndex + 1);
                });
              }
            }
            return node;
          };
          return nest({}, 0);
        }
	
	//});
});
</script>
</body>
</html>
